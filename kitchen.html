<!DOCTYPE html>
<html>
<head>
  <title>Kitchen Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#ff9800">
</head>

<body>
<h2>üç≥ Kitchen Orders</h2>
<button onclick="logout()">Logout</button>

<div id="orders">Loading orders...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, collection, onSnapshot, updateDoc, doc
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import {
  getAuth, onAuthStateChanged, signOut
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyCgaZ9DqGuszvycCRuJceNvg7G86OTc9oU",
  authDomain: "restaurant-55333.firebaseapp.com",
  projectId: "restaurant-55333"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth(app);

// üîê Protect page
onAuthStateChanged(auth, user => {
  if (!user) location.href = "login.html";
});

// üî• Live orders
const ordersDiv = document.getElementById("orders");

onSnapshot(collection(db, "orders"), snap => {
  ordersDiv.innerHTML = "";
  snap.forEach(d => {
    const o = d.data();
    ordersDiv.innerHTML += `
      <hr>
      <p><b>${o.customerName}</b> | Table ${o.tableNumber}</p>
      <p>Status: ${o.status}</p>
      <p>Items: ${o.items.map(i => i.name).join(", ")}</p>
      <button onclick="ready('${d.id}')">Mark Ready</button>
    `;
  });
});

// üîπ Mark ready
window.ready = async (id) => {
  await updateDoc(doc(db, "orders", id), {
    status: "ready",
    readyTime: 10
  });
};

// üîπ Logout
window.logout = () => {
  signOut(auth).then(() => location.href = "login.html");
};
</script>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js");
}
</script>
</body>
</html>
